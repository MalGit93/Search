{% extends "base.html" %}
{% block content %}
<section class="panel">
    <div class="panel-header">
        <div>
            <p class="eyebrow">Pipeline status</p>
            <h2>Latest insights</h2>
        </div>
        <a class="pill" href="/sources">Manage sources</a>
    </div>
    {% if insight.summary %}
    <ul class="list">
        {% for line in insight.summary.split('\n') %}
        <li>{{ line }}</li>
        {% endfor %}
    </ul>
    {% else %}
    <p>No articles available yet. Trigger a refresh to fetch new content.</p>
    {% endif %}
</section>

<section class="grid">
    <article class="panel">
        <div class="panel-header">
            <div>
                <p class="eyebrow">Keywords</p>
                <h3>Emerging trends</h3>
            </div>
        </div>
        {% if insight.trends %}
        <table class="data">
            <thead>
                <tr><th>Keyword</th><th class="numeric">Mentions</th></tr>
            </thead>
            <tbody>
            {% for trend in insight.trends %}
                <tr>
                    <td>{{ trend.keyword }}</td>
                    <td class="numeric">{{ trend.frequency }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>No trend data yet.</p>
        {% endif %}
    </article>

    <article class="panel">
        <div class="panel-header">
            <div>
                <p class="eyebrow">Recommendations</p>
                <h3>Policy suggestions</h3>
            </div>
        </div>
        {% if insight.policy_suggestions %}
        <ul class="list">
            {% for suggestion in insight.policy_suggestions %}
            <li>{{ suggestion }}</li>
            {% endfor %}
        </ul>
        {% else %}
        <p>Policy prompts will appear after the next refresh.</p>
        {% endif %}
    </article>
</section>

<section class="panel">
    <div class="panel-header">
        <div>
            <p class="eyebrow">Coverage</p>
            <h3>Recent articles</h3>
        </div>
    </div>
    {% if articles %}
    <table class="data">
        <thead>
            <tr><th>Source</th><th>Title</th><th>Published</th><th>Tags</th></tr>
        </thead>
        <tbody>
            {% for article in articles %}
            <tr>
                <td>
                    <span class="pill muted">{{ article.source_name }}</span>
                </td>
                <td>
                    <div class="title"><a href="{{ article.link }}" target="_blank" rel="noopener">{{ article.title }}</a></div>
                    {% if article.summary %}<p class="subdued">{{ article.summary }}</p>{% endif %}
                </td>
                <td class="numeric">
                    {% if article.published_at %}
                        {{ article.published_at.strftime('%Y-%m-%d') }}
                    {% else %}
                        {{ article.fetched_at.strftime('%Y-%m-%d') }}
                    {% endif %}
                </td>
                <td>{{ article.tags }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="subdued">No articles stored yet.</p>
    {% endif %}
</section>

{% if trends_by_category %}
<section class="panel">
    <div class="panel-header">
        <div>
            <p class="eyebrow">Segmented view</p>
            <h3>Trends by category</h3>
        </div>
    </div>
    <div class="pill-row">
        {% for category, trends in trends_by_category.items() %}
        <div class="pill muted">{{ category }}</div>
        <div class="trend-grid">
            {% for trend in trends %}
            <div class="trend-card">
                <p class="keyword">{{ trend.keyword }}</p>
                <p class="subdued">{{ trend.frequency }} mentions</p>
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}
{% endblock %}
